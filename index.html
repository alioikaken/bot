<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GENIUS MARKET ULTIMATE PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* 1. CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–ò–°–¢–ï–ú–ê –î–ò–ó–ê–ô–ù–ê 
        */
        :root {
            --bg-color: #000000;
            --surface-color: #0c0c0e;
            --card-color: #141417;
            --card-hover: #1c1c1f;
            --accent-color: #ff8c00;
            --accent-soft: rgba(255, 140, 0, 0.15);
            --accent-bright: #ffa500;
            --kaspi-color: #f14635;
            --stars-color: #62bcf9;
            --crypto-color: #0088cc;
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
            --text-muted: #545458;
            --border-light: rgba(255, 255, 255, 0.08);
            --border-focus: rgba(255, 140, 0, 0.4);
            --safe-area-bottom: env(safe-area-inset-bottom);
            --glass: rgba(255, 255, 255, 0.03);
            --grad-accent: linear-gradient(135deg, #ff8c00 0%, #ff5e00 100%);
        }

        /* 2. –ì–õ–û–ë–ê–õ–¨–ù–´–ô –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò 
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden; /* –°–∫—Ä–æ–ª–ª —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º */
            height: 100vh;
            width: 100vw;
            line-height: 1.4;
        }

        input, button {
            -webkit-user-select: auto;
            user-select: auto;
            font-family: inherit;
        }

        /* 3. –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù (–ì–õ–£–ë–û–ö–ò–ô –ö–û–°–ú–û–°) 
        */
        .viewport {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .bg-glow {
            position: fixed;
            top: -10%;
            right: -10%;
            width: 60%;
            height: 50%;
            background: radial-gradient(circle, var(--accent-soft) 0%, transparent 70%);
            z-index: -1;
            filter: blur(80px);
            pointer-events: none;
            animation: pulseGlow 8s infinite alternate;
        }

        @keyframes pulseGlow {
            0% { opacity: 0.4; transform: scale(1); }
            100% { opacity: 0.7; transform: scale(1.2); }
        }

        /* 4. –°–ö–ï–õ–ï–¢ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø 
        */
        .main-wrapper {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 120px; /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏—é */
            scroll-behavior: smooth;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .main-wrapper::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* 5. HEADER (–®–ê–ü–ö–ê) 
        */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
        }

        .brand {
            font-family: 'Unbounded', sans-serif;
            font-weight: 900;
            font-size: 20px;
            letter-spacing: -1px;
        }

        .brand span {
            color: var(--accent-color);
        }

        .wallet-widget {
            background: var(--card-color);
            border: 1px solid var(--border-light);
            padding: 6px 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .wallet-widget:active {
            transform: scale(0.95);
            background: var(--card-hover);
        }

        .wallet-widget i {
            color: var(--accent-color);
            font-size: 14px;
        }

        .wallet-widget span {
            font-weight: 800;
            font-size: 14px;
        }

        /* 6. –ö–ê–¢–ï–ì–û–†–ò–ò (TABS) 
        */
        .category-bar {
            padding: 15px 0 5px;
            margin-bottom: 10px;
        }

        .scroll-x {
            display: flex;
            overflow-x: auto;
            padding: 0 20px;
            gap: 8px;
            scrollbar-width: none;
        }

        .scroll-x::-webkit-scrollbar { display: none; }

        .cat-chip {
            padding: 10px 18px;
            background: var(--card-color);
            border: 1px solid var(--border-light);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            white-space: nowrap;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .cat-chip.active {
            background: var(--text-main);
            color: var(--bg-color);
            border-color: var(--text-main);
            box-shadow: 0 4px 12px rgba(255,255,255,0.1);
        }

        /* 7. –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í 
        */
        .products-container {
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .product-card {
            background: var(--card-color);
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card:active {
            transform: scale(0.98);
            background: var(--card-hover);
            border-color: var(--accent-soft);
        }

        .product-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: var(--surface-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            border: 1px solid var(--border-light);
            object-fit: cover;
        }

        .product-info b {
            display: block;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .product-info span {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-right {
            text-align: right;
        }

        .product-price {
            font-family: 'Unbounded', sans-serif;
            font-size: 15px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 6px;
        }

        .buy-button {
            background: var(--text-main);
            color: var(--bg-color);
            padding: 6px 14px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* 8. –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–ê–Ø –ü–ê–ù–ï–õ–¨ 
        */
        .bottom-nav {
            position: fixed;
            bottom: 25px;
            left: 20px;
            right: 20px;
            background: rgba(18, 18, 20, 0.85);
            backdrop-filter: blur(25px);
            border: 1px solid var(--border-light);
            border-radius: 28px;
            display: flex;
            padding: 8px;
            z-index: 2000;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 0;
            font-size: 10px;
            font-weight: 700;
            transition: 0.3s ease;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 4px;
            transition: 0.3s ease;
        }

        .nav-item.active {
            color: var(--text-main);
        }

        .nav-item.active i {
            color: var(--accent-color);
            transform: translateY(-3px);
        }

        /* 9. –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê (BOTTOM SHEETS) 
        */
        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 3000;
            display: none;
            align-items: flex-end;
            backdrop-filter: blur(8px);
            transition: all 0.3s;
        }

        .overlay.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .sheet {
            width: 100%;
            background: var(--surface-color);
            border-radius: 32px 32px 0 0;
            padding: 24px 24px calc(24px + var(--safe-area-bottom));
            transform: translateY(100%);
            border-top: 1px solid var(--border-light);
            max-height: 90vh;
            overflow-y: auto;
        }

        .overlay.visible .sheet {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .sheet-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .sheet-bar {
            width: 40px;
            height: 4px;
            background: var(--text-muted);
            border-radius: 2px;
            margin: -10px auto 15px;
        }

        .sheet-title {
            font-family: 'Unbounded', sans-serif;
            font-size: 20px;
            margin-bottom: 8px;
        }

        /* 10. –ü–õ–ê–¢–ï–ñ–ù–´–ï –ú–ï–¢–û–î–´ 
        */
        .payment-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .pay-option {
            background: var(--card-color);
            border: 1px solid var(--border-light);
            border-radius: 20px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: 0.2s;
        }

        .pay-option:active {
            border-color: var(--accent-color);
            background: var(--card-hover);
        }

        .pay-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .kaspi-bg { background: var(--kaspi-color); color: white; }
        .stars-bg { background: var(--stars-color); color: white; }
        .crypto-bg { background: var(--crypto-color); color: white; }

        .pay-details b {
            display: block;
            font-size: 15px;
        }

        .pay-details span {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* 11. –ü–†–û–§–ò–õ–¨ 
        */
        .profile-view {
            padding: 20px;
        }

        .user-card {
            background: var(--grad-accent);
            padding: 30px 20px;
            border-radius: 28px;
            color: black;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px var(--accent-soft);
        }

        .avatar-placeholder {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 28px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: var(--card-color);
            padding: 20px;
            border-radius: 24px;
            border: 1px solid var(--border-light);
            text-align: center;
        }

        .stat-item h3 {
            font-family: 'Unbounded', sans-serif;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .stat-item p {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 700;
        }

        /* 12. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ö–õ–ê–°–°–´ 
        */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .w-full { width: 100%; }
        .mt-20 { margin-top: 20px; }
        .text-center { text-align: center; }

        .btn-action {
            background: var(--text-main);
            color: var(--bg-color);
            border: none;
            padding: 18px;
            border-radius: 18px;
            font-family: 'Unbounded', sans-serif;
            font-weight: 700;
            font-size: 14px;
            width: 100%;
            transition: 0.2s;
        }

        .btn-action:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        .copy-box {
            background: #000;
            border: 1px dashed var(--accent-color);
            padding: 20px;
            border-radius: 16px;
            font-family: 'Unbounded', sans-serif;
            font-size: 18px;
            color: var(--accent-color);
            margin: 15px 0;
            cursor: pointer;
        }

        /* 13. –°–ï–ö–¶–ò–Ø –ü–û–ì–†–£–ó–ö–ò (LOADER) 
        */
        #preloader {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .loader-logo {
            font-family: 'Unbounded', sans-serif;
            font-size: 30px;
            font-weight: 900;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

    </style>
</head>
<body>

    <div id="preloader">
        <div class="loader-logo">GENIUS<span>.</span></div>
        <div style="width: 150px; height: 2px; background: #222; border-radius: 2px; overflow: hidden;">
            <div id="loading-bar" style="width: 0%; height: 100%; background: var(--accent-color); transition: 0.3s;"></div>
        </div>
    </div>

    <div class="viewport">
        <div class="bg-glow"></div>

        <header class="app-header">
            <div class="brand">GENIUS<span>.</span>MARKET</div>
            <div class="wallet-widget" onclick="App.showTopUp()">
                <i class="fa-solid fa-wallet"></i>
                <span id="header-balance">0 ‚Ç∏</span>
            </div>
        </header>

        <div class="main-wrapper" id="main-scroller">
            
            <section id="view-store">
                <div class="category-bar">
                    <div class="scroll-x">
                        <div class="cat-chip active" onclick="App.filter('all', this)">‚ö° –í—Å–µ</div>
                        <div class="cat-chip" onclick="App.filter('wa', this)">WhatsApp</div>
                        <div class="cat-chip" onclick="App.filter('tg', this)">Telegram</div>
                        <div class="cat-chip" onclick="App.filter('nft', this)">Digital NFT</div>
                        <div class="cat-chip" onclick="App.filter('sub', this)">–ü–æ–¥–ø–∏—Å–∫–∏</div>
                    </div>
                </div>

                <div class="products-container" id="catalog-grid">
                    </div>
            </section>

            <section id="view-profile" class="hidden">
                <div class="profile-view">
                    <div class="user-card">
                        <div class="avatar-placeholder" id="user-avatar">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <h2 id="user-full-name">Genius User</h2>
                        <p id="user-tg-id" style="font-weight: 600; font-size: 13px; opacity: 0.7;">ID: 00000000</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <h3 id="stat-bal">0 ‚Ç∏</h3>
                            <p>–ë–∞–ª–∞–Ω—Å</p>
                        </div>
                        <div class="stat-item">
                            <h3 id="stat-orders">0</h3>
                            <p>–ó–∞–∫–∞–∑—ã</p>
                        </div>
                    </div>

                    <div class="products-container">
                        <div class="product-card" onclick="tg.showAlert('–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞')">
                            <div class="product-left">
                                <div class="product-image" style="font-size: 18px;"><i class="fa-solid fa-receipt"></i></div>
                                <div class="product-info"><b>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</b><span>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —á–µ–∫–∏</span></div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                        <div class="product-card" onclick="tg.openTelegramLink('https://t.me/support')">
                            <div class="product-left">
                                <div class="product-image" style="font-size: 18px;"><i class="fa-solid fa-headset"></i></div>
                                <div class="product-info"><b>–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</b><span>–ü–æ–º–æ—â—å 24/7</span></div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color: var(--text-muted);"></i>
                        </div>
                    </div>
                </div>
            </section>

        </div>

        <nav class="bottom-nav">
            <a href="javascript:void(0)" class="nav-item active" onclick="App.switchTab('store', this)">
                <i class="fa-solid fa-house"></i>
                –ì–ª–∞–≤–Ω–∞—è
            </a>
            <a href="javascript:void(0)" class="nav-item" onclick="tg.showAlert('–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤')">
                <i class="fa-solid fa-box-open"></i>
                –ú–æ–∏ —Ç–æ–≤–∞—Ä—ã
            </a>
            <a href="javascript:void(0)" class="nav-item" onclick="App.switchTab('profile', this)">
                <i class="fa-solid fa-circle-user"></i>
                –ü—Ä–æ—Ñ–∏–ª—å
            </a>
        </nav>
    </div>

    <div class="overlay" id="main-overlay" onclick="App.closeOverlay()">
        <div class="sheet" onclick="event.stopPropagation()">
            <div class="sheet-bar"></div>
            
            <div id="sheet-pay-methods" class="hidden">
                <div class="sheet-header">
                    <h2 class="sheet-title">–û–ø–ª–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞</h2>
                    <p style="color: var(--text-secondary); font-size: 14px;">–í—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ: <b id="pay-item-name" style="color: var(--accent-color);">...</b></p>
                </div>

                <div class="payment-list">
                    <div class="pay-option" onclick="App.handlePay('kaspi')">
                        <div class="pay-icon-box kaspi-bg"><i class="fa-solid fa-university"></i></div>
                        <div class="pay-details"><b>Kaspi Gold</b><span>–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ (‚Ç∏)</span></div>
                        <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--text-muted);"></i>
                    </div>
                    <div class="pay-option" onclick="App.handlePay('stars')">
                        <div class="pay-icon-box stars-bg"><i class="fa-solid fa-star"></i></div>
                        <div class="pay-details"><b>Telegram Stars</b><span>–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram (‚ú®)</span></div>
                        <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--text-muted);"></i>
                    </div>
                    <div class="pay-option" onclick="App.handlePay('crypto')">
                        <div class="pay-icon-box crypto-bg"><i class="fa-solid fa-bolt"></i></div>
                        <div class="pay-details"><b>CryptoBot</b><span>USDT / TON / BTC</span></div>
                        <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--text-muted);"></i>
                    </div>
                </div>
            </div>

            <div id="sheet-kaspi-flow" class="hidden">
                <div class="sheet-header">
                    <h2 class="sheet-title" style="color: var(--kaspi-color);">Kaspi Transfer</h2>
                    <p style="color: var(--text-secondary); font-size: 14px;">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞ –∫–∞—Ä—Ç—É –Ω–∏–∂–µ:</p>
                </div>
                <div class="copy-box" onclick="App.copyCard()">4400 4302 1122 3344</div>
                <div class="text-center mt-20">
                    <p style="font-size: 13px; color: var(--text-secondary);">–ö –æ–ø–ª–∞—Ç–µ: <b style="font-size: 24px; color: var(--text-main);" id="kaspi-total">0 ‚Ç∏</b></p>
                    <p style="font-size: 11px; color: var(--text-muted); margin-top: 5px;">–ü–æ–ª—É—á–∞—Ç–µ–ª—å: Genius Market Admin</p>
                </div>
                <button class="btn-action mt-20" onclick="App.confirmOrder('Kaspi')">–Ø –û–ü–õ–ê–¢–ò–õ</button>
            </div>

            <div id="sheet-topup" class="hidden">
                <div class="sheet-header">
                    <h2 class="sheet-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
                    <p style="color: var(--text-secondary); font-size: 14px;">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞</p>
                </div>
                <div style="background: #000; border-radius: 18px; padding: 20px; border: 1px solid var(--border-light); display: flex; align-items: center; gap: 15px;">
                    <input type="number" id="topup-input" placeholder="0" style="background: none; border: none; color: white; font-family: 'Unbounded'; font-size: 24px; width: 100%; outline: none;">
                    <span style="font-family: 'Unbounded'; font-weight: 700;">‚Ç∏</span>
                </div>
                <button class="btn-action mt-20" onclick="App.processTopUp()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
            </div>

            <button onclick="App.closeOverlay()" style="width: 100%; background: none; border: none; color: var(--text-muted); margin-top: 25px; font-weight: 700; font-size: 13px;">–û–¢–ú–ï–ù–ò–¢–¨</button>
        </div>
    </div>

    <script>
        /**
         * –ö–û–†–ù–ï–í–û–ô –û–ë–™–ï–ö–¢ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
         * –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å—ë: –¥–∞–Ω–Ω—ã–µ, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
         */
        const tg = window.Telegram.WebApp;

        const App = {
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (State)
            state: {
                balance: 0,
                ordersCount: 0,
                activeTab: 'all',
                currentSelection: null,
                user: {
                    id: 0,
                    firstName: 'Guest',
                    lastName: '',
                    username: ''
                },
                // –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–û–í (–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã)
                catalog: [
                    { id: 1, type: 'wa', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (+7)', price: 1250, icon: 'üá∞üáø', stock: '1,420' },
                    { id: 2, type: 'wa', name: '–°–®–ê (–§–∏–∑. –Ω–æ–º–µ—Ä)', price: 850, icon: 'üá∫üá∏', stock: '98' },
                    { id: 3, type: 'wa', name: '–†–æ—Å—Å–∏—è (–í–∏—Ä—Ç)', price: 680, icon: 'üá∑üá∫', stock: '12k+' },
                    { id: 4, type: 'wa', name: '–ò–Ω–¥–æ–Ω–µ–∑–∏—è', price: 450, icon: 'üáÆüá©', stock: '2,100' },
                    { id: 5, type: 'wa', name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', price: 1100, icon: 'üá¨üáß', stock: '43' },
                    
                    { id: 10, type: 'tg', name: 'Premium (1 –º–µ—Å—è—Ü)', price: 1400, icon: '‚≠ê', stock: '‚àû' },
                    { id: 11, type: 'tg', name: 'Premium (1 –≥–æ–¥)', price: 9990, icon: 'üíé', stock: '‚àû' },
                    { id: 12, type: 'tg', name: 'Stars (100 —à—Ç)', price: 850, icon: '‚ú®', stock: '‚àû' },
                    { id: 13, type: 'tg', name: 'Stars (500 —à—Ç)', price: 4100, icon: 'üåå', stock: '‚àû' },
                    { id: 14, type: 'tg', name: 'Fragment –ù–æ–º–µ—Ä', price: 8200, icon: 'üì±', stock: '15' },

                    { id: 20, type: 'nft', name: 'Resistance Dog NFT', price: 45000, icon: 'https://redot.com/blog/content/images/2020/12/ton-1.png', isImg: true, stock: '1' },
                    { id: 21, type: 'nft', name: 'Whale Fin NFT', price: 18000, icon: 'https://cdn-icons-png.flaticon.com/512/3063/3063067.png', isImg: true, stock: '4' },
                    { id: 22, type: 'nft', name: 'Pavel Durov Gift', price: 25000, icon: 'üéÅ', stock: '2' },

                    { id: 30, type: 'sub', name: 'ChatGPT Plus', price: 9200, icon: 'ü§ñ', stock: '10' },
                    { id: 31, type: 'sub', name: 'Discord Nitro', price: 1900, icon: 'üëæ', stock: '100+' },
                    { id: 32, type: 'sub', name: 'YouTube Premium', price: 1500, icon: 'üì∫', stock: '50' }
                ]
            },

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            init() {
                tg.expand();
                tg.headerColor = '#000000';
                tg.backgroundColor = '#000000';

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const u = tg.initDataUnsafe.user;
                    this.state.user = {
                        id: u.id,
                        firstName: u.first_name,
                        lastName: u.last_name || '',
                        username: u.username || ''
                    };
                    document.getElementById('user-full-name').innerText = u.first_name + (u.last_name ? ' ' + u.last_name : '');
                    document.getElementById('user-tg-id').innerText = 'ID: ' + u.id;
                }

                // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                let progress = 0;
                const bar = document.getElementById('loading-bar');
                const interval = setInterval(() => {
                    progress += Math.random() * 30;
                    bar.style.width = Math.min(progress, 100) + '%';
                    if (progress >= 100) {
                        clearInterval(interval);
                        document.getElementById('preloader').style.display = 'none';
                    }
                }, 150);

                this.renderCatalog('all');
                this.updateUI();
            },

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
            renderCatalog(category) {
                const grid = document.getElementById('catalog-grid');
                grid.innerHTML = '';

                const filtered = category === 'all' 
                    ? this.state.catalog 
                    : this.state.catalog.filter(i => i.type === category);

                filtered.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <div class="product-left">
                            <div class="product-image">
                                ${item.isImg ? `<img src="${item.icon}" style="width:100%;height:100%;border-radius:14px;object-fit:cover;">` : item.icon}
                            </div>
                            <div class="product-info">
                                <b>${item.name}</b>
                                <span><i class="fa-solid fa-layer-group"></i> –°–∫–ª–∞–¥: ${item.stock}</span>
                            </div>
                        </div>
                        <div class="product-right">
                            <div class="product-price">${item.price.toLocaleString()} ‚Ç∏</div>
                            <div class="buy-button">–í—ã–±—Ä–∞—Ç—å</div>
                        </div>
                    `;
                    card.onclick = () => this.openPurchase(item);
                    grid.appendChild(card);
                });
            },

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞
            filter(cat, el) {
                document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
                el.classList.add('active');
                this.state.activeTab = cat;
                tg.HapticFeedback.impactOccurred('light');
                this.renderCatalog(cat);
            },

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ (Store / Profile)
            switchTab(view, el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');

                const store = document.getElementById('view-store');
                const profile = document.getElementById('view-profile');

                if (view === 'profile') {
                    store.classList.add('hidden');
                    profile.classList.remove('hidden');
                } else {
                    store.classList.remove('hidden');
                    profile.classList.add('hidden');
                }
                tg.HapticFeedback.impactOccurred('medium');
                window.scrollTo(0,0);
            },

            // –õ–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
            openPurchase(item) {
                this.state.currentSelection = item;
                document.getElementById('pay-item-name').innerText = item.name;
                document.getElementById('kaspi-total').innerText = item.price.toLocaleString() + ' ‚Ç∏';
                
                // –°–±—Ä–æ—Å –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π —à–∞–≥
                this.hideAllSheetSections();
                document.getElementById('sheet-pay-methods').classList.remove('hidden');
                
                const overlay = document.getElementById('main-overlay');
                overlay.classList.add('visible');
                tg.HapticFeedback.impactOccurred('medium');
            },

            handlePay(method) {
                tg.HapticFeedback.impactOccurred('light');
                this.hideAllSheetSections();

                if (method === 'kaspi') {
                    document.getElementById('sheet-kaspi-flow').classList.remove('hidden');
                } else if (method === 'stars') {
                    const starsNeeded = Math.ceil(this.state.currentSelection.price / 8.5);
                    tg.showConfirm(`–û–ø–ª–∞—Ç–∏—Ç—å ${starsNeeded} ‚ú® –∑–∞ —Ç–æ–≤–∞—Ä ${this.state.currentSelection.name}?`, (ok) => {
                        if (ok) this.confirmOrder('Telegram Stars');
                    });
                } else {
                    tg.showAlert("–ú–µ—Ç–æ–¥ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Kaspi.");
                    document.getElementById('sheet-pay-methods').classList.remove('hidden');
                }
            },

            copyCard() {
                const card = "4400430211223344";
                const el = document.createElement('textarea');
                el.value = card;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                
                tg.HapticFeedback.notificationOccurred('success');
                tg.showAlert('–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            },

            confirmOrder(method) {
                tg.HapticFeedback.notificationOccurred('success');
                tg.showPopup({
                    title: '–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!',
                    message: `–í–∞—à –ø–ª–∞—Ç–µ–∂ (${method}) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç.`,
                    buttons: [{type: 'ok'}]
                });
                this.state.ordersCount++;
                this.updateUI();
                this.closeOverlay();
            },

            // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
            showTopUp() {
                this.hideAllSheetSections();
                document.getElementById('sheet-topup').classList.remove('hidden');
                document.getElementById('main-overlay').classList.add('visible');
                tg.HapticFeedback.impactOccurred('medium');
            },

            processTopUp() {
                const amount = document.getElementById('topup-input').value;
                if (!amount || amount < 500) {
                    tg.showAlert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî 500 ‚Ç∏');
                    return;
                }
                tg.showConfirm(`–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å—É–º–º—É ${amount} ‚Ç∏?`, (ok) => {
                    if (ok) {
                        tg.showAlert('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                        this.closeOverlay();
                    }
                });
            },

            // –°–ª—É–∂–µ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UI
            updateUI() {
                const bal = this.state.balance.toLocaleString() + ' ‚Ç∏';
                document.getElementById('header-balance').innerText = bal;
                document.getElementById('stat-bal').innerText = bal;
                document.getElementById('stat-orders').innerText = this.state.ordersCount;
            },

            closeOverlay() {
                document.getElementById('main-overlay').classList.remove('visible');
            },

            hideAllSheetSections() {
                document.getElementById('sheet-pay-methods').classList.add('hidden');
                document.getElementById('sheet-kaspi-flow').classList.add('hidden');
                document.getElementById('sheet-topup').classList.add('hidden');
            }
        };

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.onload = () => App.init();

    </script>
</body>
</html>
