<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GENIUS MARKET ULTIMATE V2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --bg: #000000;
            --surface: #0a0a0b;
            --card: #121214;
            --card-hover: #1c1c1e;
            --accent: #ff8c00;
            --accent-glow: rgba(255, 140, 0, 0.25);
            --kaspi: #f14635;
            --stars: #62bcf9;
            --crypto: #0088cc;
            --text: #ffffff;
            --text-dim: #8e8e93;
            --border: rgba(255, 255, 255, 0.06);
            --grad: linear-gradient(135deg, var(--accent) 0%, #ff5e00 100%);
        }

        /* –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        /* CUSTOM SCROLLBAR –î–õ–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø */
        .app-container {
            height: 100vh;
            overflow-y: scroll;
            overflow-x: hidden;
            padding-bottom: 140px;
            scroll-behavior: smooth;
        }
        .app-container::-webkit-scrollbar { display: none; }

        /* –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù */
        .orb {
            position: fixed;
            width: 500px; height: 500px;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            z-index: -1; filter: blur(100px);
            pointer-events: none;
            opacity: 0.5;
        }

        /* –®–ê–ü–ö–ê */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(25px);
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .logo { font-family: 'Unbounded'; font-weight: 900; font-size: 22px; letter-spacing: -1.5px; }
        .logo span { color: var(--accent); }

        .header-actions { display: flex; gap: 10px; }
        .balance-badge {
            background: var(--card); border: 1px solid var(--border);
            padding: 8px 15px; border-radius: 14px; display: flex; align-items: center; gap: 8px;
            font-weight: 800; font-size: 15px; transition: 0.3s;
        }
        .balance-badge:active { transform: scale(0.95); background: var(--border); }
        .balance-badge i { color: var(--accent); font-size: 14px; }

        /* –°–ö–ï–õ–ï–¢–û–ù –ò –õ–û–ê–î–ï–† */
        #loading-screen {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* –¢–ê–ë–´ */
        .tabs-wrapper { padding: 15px 20px; position: sticky; top: 75px; background: var(--bg); z-index: 900; }
        .tabs-scroll { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; }
        .tabs-scroll::-webkit-scrollbar { display: none; }
        .tab-btn {
            padding: 12px 22px; background: var(--card); border-radius: 100px;
            color: var(--text-dim); font-size: 14px; font-weight: 700;
            white-space: nowrap; transition: 0.3s; border: 1px solid var(--border);
        }
        .tab-btn.active { background: var(--text); color: #000; border-color: var(--text); }

        /* –ö–ê–†–¢–û–ß–ö–ò –¢–û–í–ê–†–û–í */
        .grid { padding: 0 20px; display: grid; gap: 14px; }
        .card-item {
            background: var(--card); border-radius: 28px; padding: 20px;
            display: flex; align-items: center; justify-content: space-between;
            border: 1px solid var(--border); transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .card-item:active { transform: scale(0.97); background: var(--card-hover); }

        .card-main { display: flex; align-items: center; gap: 18px; }
        .card-img {
            width: 64px; height: 64px; border-radius: 20px; object-fit: cover;
            background: #1a1a1c; display: flex; align-items: center; justify-content: center;
            font-size: 28px; border: 1px solid var(--border);
        }

        .card-info b { font-size: 17px; display: block; margin-bottom: 4px; }
        .card-info span { font-size: 12px; color: var(--text-dim); display: block; }
        
        .card-price-block { text-align: right; }
        .price-txt { font-family: 'Unbounded'; font-size: 16px; font-weight: 700; color: var(--accent); }
        .buy-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--text-dim); margin-top: 5px; }

        /* –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò */
        .nav-dock {
            position: fixed; bottom: 30px; left: 20px; right: 20px;
            background: rgba(18, 18, 20, 0.85); backdrop-filter: blur(30px);
            border-radius: 30px; padding: 10px; display: flex; justify-content: space-around;
            border: 1px solid var(--border); z-index: 2000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        .nav-trigger {
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-dim); text-decoration: none; font-size: 11px;
            font-weight: 700; width: 20%; transition: 0.3s;
        }
        .nav-trigger i { font-size: 22px; margin-bottom: 5px; }
        .nav-trigger.active { color: var(--text); }
        .nav-trigger.active i { color: var(--accent); transform: translateY(-5px); }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .sheet {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 3000; opacity: 0; pointer-events: none; transition: 0.4s;
            display: flex; align-items: flex-end;
        }
        .sheet.open { opacity: 1; pointer-events: auto; }
        
        .sheet-body {
            width: 100%; background: #0c0c0e; border-radius: 35px 35px 0 0;
            padding: 30px; transform: translateY(100%); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border-top: 1px solid var(--border); max-height: 90vh; overflow-y: auto;
        }
        .sheet.open .sheet-body { transform: translateY(0); }

        .sheet-title { font-family: 'Unbounded'; font-size: 22px; margin: 0 0 10px; }
        .sheet-desc { color: var(--text-dim); font-size: 14px; margin-bottom: 25px; line-height: 1.5; }

        /* –ü–õ–ê–¢–ï–ñ–ù–´–ï –ö–ù–û–ü–ö–ò */
        .pay-card {
            background: var(--card); border-radius: 22px; padding: 20px;
            display: flex; align-items: center; gap: 15px; margin-bottom: 12px;
            border: 1px solid var(--border); transition: 0.2s;
        }
        .pay-card:active { border-color: var(--accent); background: #1a1a1c; }
        .pay-icon { width: 48px; height: 48px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; }

        .btn-confirm {
            width: 100%; padding: 22px; border-radius: 20px; border: none;
            background: var(--text); color: #000; font-family: 'Unbounded';
            font-weight: 700; font-size: 15px; margin-top: 15px; box-shadow: 0 10px 20px rgba(255,255,255,0.05);
        }

        /* –ü–†–û–§–ò–õ–¨ */
        .profile-hero {
            padding: 40px 20px; text-align: center;
        }
        .user-circle {
            width: 100px; height: 100px; background: var(--grad);
            border-radius: 35px; margin: 0 auto 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px; color: #000; box-shadow: 0 15px 30px var(--accent-glow);
        }
        .profile-stat-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px;
        }
        .stat-box {
            background: var(--card); border: 1px solid var(--border);
            padding: 20px; border-radius: 24px; text-align: center;
        }
        .stat-box b { display: block; font-size: 20px; font-family: 'Unbounded'; margin-bottom: 5px; }
        .stat-box span { font-size: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

        /* –ü–û–ü–û–õ–ù–ï–ù–ò–ï */
        .topup-input-wrap {
            background: #000; border: 1px solid var(--border);
            border-radius: 18px; padding: 15px; display: flex; align-items: center; gap: 10px;
            margin-bottom: 20px;
        }
        .topup-input-wrap input {
            background: none; border: none; color: white; font-size: 24px; font-family: 'Unbounded';
            width: 100%; outline: none;
        }

        .hidden { display: none; }
        .text-kaspi { color: var(--kaspi); }
        .text-stars { color: var(--stars); }
        .text-crypto { color: var(--crypto); }

    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="logo">GENIUS<span>.</span></div>
        <div class="spinner" style="margin-top: 25px;"></div>
    </div>

    <div class="orb" style="top: -100px; right: -100px;"></div>
    <div class="orb" style="bottom: -100px; left: -100px;"></div>

    <div class="app-container" id="scroll-node">
        
        <header>
            <div class="logo">GENIUS<span>.</span></div>
            <div class="header-actions">
                <div class="balance-badge" onclick="showTopUp()">
                    <i class="fa-solid fa-tenge-sign"></i>
                    <span id="global-balance">0 ‚Ç∏</span>
                    <i class="fa-solid fa-plus" style="font-size: 10px; margin-left: 5px; color: var(--text-dim);"></i>
                </div>
            </div>
        </header>

        <div id="view-store">
            <div class="tabs-wrapper">
                <div class="tabs-scroll">
                    <button class="tab-btn active" onclick="ui.filter('all', this)">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
                    <button class="tab-btn" onclick="ui.filter('wa', this)">WhatsApp</button>
                    <button class="tab-btn" onclick="ui.filter('tg', this)">Telegram</button>
                    <button class="tab-btn" onclick="ui.filter('nft', this)">Digital NFT</button>
                    <button class="tab-btn" onclick="ui.filter('other', this)">–ü—Ä–æ—á–µ–µ</button>
                </div>
            </div>

            <div class="grid" id="catalog-grid">
                </div>
        </div>

        <div id="view-profile" class="hidden">
            <div class="profile-hero">
                <div class="user-circle"><i class="fa-solid fa-crown"></i></div>
                <h2 id="p-full-name" style="font-family: 'Unbounded'; margin: 0;">Genius Guest</h2>
                <p id="p-tg-id" style="color: var(--text-dim); margin: 5px 0;">ID: 000000000</p>
            </div>

            <div style="padding: 0 20px;">
                <div class="profile-stat-grid">
                    <div class="stat-box">
                        <b id="stat-balance">0 ‚Ç∏</b>
                        <span>–ë–∞–ª–∞–Ω—Å</span>
                    </div>
                    <div class="stat-box">
                        <b id="stat-orders">0</b>
                        <span>–ü–æ–∫—É–ø–∫–∏</span>
                    </div>
                </div>

                <div class="grid">
                    <div class="card-item" onclick="tg.showAlert('–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞')">
                        <div class="card-main">
                            <div class="card-img" style="font-size: 20px;"><i class="fa-solid fa-clock-rotate-left"></i></div>
                            <div class="card-info"><b>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</b><span>–í–∞—à–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</span></div>
                        </div>
                        <i class="fa-solid fa-chevron-right" style="color: var(--border);"></i>
                    </div>
                    <div class="card-item" onclick="tg.openTelegramLink('https://t.me/support')">
                        <div class="card-main">
                            <div class="card-img" style="font-size: 20px;"><i class="fa-solid fa-headset"></i></div>
                            <div class="card-info"><b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</b><span>–°–≤—è–∑–∞—Ç—å—Å—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º</span></div>
                        </div>
                        <i class="fa-solid fa-chevron-right" style="color: var(--border);"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav-dock">
        <a href="javascript:void(0)" class="nav-trigger active" id="nav-home" onclick="ui.switchView('store')">
            <i class="fa-solid fa-grid-2"></i>–ú–∞–≥–∞–∑–∏–Ω
        </a>
        <a href="javascript:void(0)" class="nav-trigger" onclick="tg.showAlert('–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤')">
            <i class="fa-solid fa-bolt"></i>–ê–∫—Ç–∏–≤–Ω—ã–µ
        </a>
        <a href="javascript:void(0)" class="nav-trigger" id="nav-profile" onclick="ui.switchView('profile')">
            <i class="fa-solid fa-user-vneck"></i>–ü—Ä–æ—Ñ–∏–ª—å
        </a>
    </nav>

    <div class="sheet" id="buy-sheet">
        <div class="sheet-body">
            <div style="width: 40px; height: 5px; background: var(--border); margin: -10px auto 25px; border-radius: 10px;"></div>
            
            <div id="payment-methods-view">
                <h2 class="sheet-title">–û–ø–ª–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞</h2>
                <p class="sheet-desc">–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –¥–ª—è: <br><b id="checkout-title" class="text-accent">-</b></p>
                
                <div class="pay-card" onclick="logic.pay('kaspi')">
                    <div class="pay-icon" style="background: var(--kaspi);"><i class="fa-solid fa-university"></i></div>
                    <div class="pay-info"><b>Kaspi Gold</b><span>–ü–µ—Ä–µ–≤–æ–¥ (‚Ç∏)</span></div>
                    <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--border);"></i>
                </div>

                <div class="pay-card" onclick="logic.pay('stars')">
                    <div class="pay-icon" style="background: var(--stars);"><i class="fa-solid fa-star"></i></div>
                    <div class="pay-info"><b>Telegram Stars</b><span>–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram (‚ú®)</span></div>
                    <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--border);"></i>
                </div>

                <div class="pay-card" onclick="logic.pay('crypto')">
                    <div class="pay-icon" style="background: var(--crypto);"><i class="fa-solid fa-bolt"></i></div>
                    <div class="pay-info"><b>CryptoBot</b><span>–ß–µ–∫–∏ /send (USDT/TON)</span></div>
                    <i class="fa-solid fa-chevron-right" style="margin-left: auto; color: var(--border);"></i>
                </div>
            </div>

            <div id="kaspi-details" class="hidden">
                <h2 class="sheet-title">–ü–µ—Ä–µ–≤–æ–¥ Kaspi</h2>
                <div style="background: #000; padding: 25px; border-radius: 20px; border: 1px dashed var(--kaspi); text-align: center; margin: 20px 0;">
                    <span style="color: var(--text-dim); font-size: 12px; text-transform: uppercase;">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</span>
                    <div id="card-num" style="font-family: 'Unbounded'; font-size: 20px; margin: 10px 0; color: var(--text);" onclick="logic.copyCard()">4400 4302 9988 7766</div>
                    <small style="color: var(--kaspi);">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–æ–º–µ—Ä, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</small>
                </div>
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="margin: 0; color: var(--text-dim);">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</p>
                    <b style="font-size: 28px; font-family: 'Unbounded';" id="kaspi-price-final">0 ‚Ç∏</b>
                </div>
                <button class="btn-confirm" style="background: var(--kaspi); color: #fff;" onclick="logic.finalize('Kaspi')">–Ø –û–ü–õ–ê–¢–ò–õ</button>
            </div>

            <button onclick="ui.closeSheets()" style="width: 100%; background: none; border: none; color: var(--text-dim); margin-top: 20px; font-weight: 700;">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div class="sheet" id="topup-sheet">
        <div class="sheet-body">
            <div style="width: 40px; height: 5px; background: var(--border); margin: -10px auto 25px; border-radius: 10px;"></div>
            <h2 class="sheet-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
            <p class="sheet-desc">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ç–µ–Ω–≥–µ, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –∑–∞—á–∏—Å–ª–∏—Ç—å –Ω–∞ –±–∞–ª–∞–Ω—Å.</p>
            
            <div class="topup-input-wrap">
                <input type="number" id="topup-amount" placeholder="0" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                <span style="font-family: 'Unbounded'; font-weight: 700;">‚Ç∏</span>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 25px;">
                <button class="tab-btn" style="padding: 10px;" onclick="document.getElementById('topup-amount').value = 1000">1,000</button>
                <button class="tab-btn" style="padding: 10px;" onclick="document.getElementById('topup-amount').value = 5000">5,000</button>
                <button class="tab-btn" style="padding: 10px;" onclick="document.getElementById('topup-amount').value = 10000">10,000</button>
            </div>

            <button class="btn-confirm" onclick="logic.startTopUp()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
        </div>
    </div>

    <script>
        /**
         * GENIUS MARKET ENGINE v2.0
         * Core Logic & Data Management
         */

        const STATE = {
            user: { balance: 0, orders: 0, id: 0, name: "Guest" },
            catalog: [
                { id: 1, cat: 'wa', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (+7)', price: 1250, img: 'üá∞üáø', stock: '1,420' },
                { id: 2, cat: 'wa', name: '–°–®–ê (–§–∏–∑. –Ω–æ–º–µ—Ä)', price: 850, img: 'üá∫üá∏', stock: '540' },
                { id: 3, cat: 'wa', name: '–†–æ—Å—Å–∏—è (–í–∏—Ä—Ç)', price: 680, img: 'üá∑üá∫', stock: '12k+' },
                { id: 4, cat: 'wa', name: '–ò–Ω–¥–æ–Ω–µ–∑–∏—è', price: 320, img: 'üáÆüá©', stock: '3.1k' },
                { id: 5, cat: 'wa', name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', price: 1100, img: 'üá¨üáß', stock: '210' },
                
                { id: 10, cat: 'tg', name: 'Premium (1 –º–µ—Å—è—Ü)', price: 1400, img: '‚≠ê', stock: '‚àû' },
                { id: 11, cat: 'tg', name: 'Premium (1 –≥–æ–¥)', price: 9990, img: 'üíé', stock: '‚àû' },
                { id: 12, cat: 'tg', name: 'Stars (100 —à—Ç)', price: 850, img: '‚ú®', stock: '‚àû' },
                { id: 13, cat: 'tg', name: 'Stars (500 —à—Ç)', price: 4100, img: 'üåå', stock: '‚àû' },
                { id: 14, cat: 'tg', name: 'Fragment –ù–æ–º–µ—Ä', price: 7800, img: 'üì±', stock: '12' },

                { id: 20, cat: 'nft', name: 'Dog House NFT', price: 15000, img: 'https://cdn.joincommunity.xyz/ton/doghouse.png', isImg: true, stock: '1' },
                { id: 21, cat: 'nft', name: 'Resistance Dog', price: 45000, img: 'https://redot.com/blog/content/images/2020/12/ton-1.png', isImg: true, stock: '1' },
                { id: 22, cat: 'nft', name: 'Whale Fin NFT', price: 22000, img: 'https://nftcalendar.io/storage/uploads/events/2022/1/1643198031_whale_fin.gif', isImg: true, stock: '2' },

                { id: 30, cat: 'other', name: 'ChatGPT Plus', price: 9500, img: 'ü§ñ', stock: '10' },
                { id: 31, cat: 'other', name: 'Discord Nitro', price: 1800, img: 'üëæ', stock: '50' }
            ],
            currentSelection: null
        };

        const ui = {
            init() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö "–±—ç–∫–µ–Ω–¥–æ–º"
                setTimeout(() => {
                    document.getElementById('loading-screen').style.opacity = '0';
                    setTimeout(() => document.getElementById('loading-screen').classList.add('hidden'), 500);
                }, 1800);

                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if(tg.initDataUnsafe.user) {
                    const u = tg.initDataUnsafe.user;
                    STATE.user.id = u.id;
                    STATE.user.name = u.first_name;
                    document.getElementById('p-full-name').innerText = u.first_name + (u.last_name ? ' ' + u.last_name : '');
                    document.getElementById('p-tg-id').innerText = "ID: " + u.id;
                }

                this.renderCatalog('all');
                this.updateBalances();
            },

            renderCatalog(category) {
                const grid = document.getElementById('catalog-grid');
                grid.innerHTML = '';

                const items = category === 'all' ? STATE.catalog : STATE.catalog.filter(i => i.cat === category);

                items.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'card-item';
                    el.innerHTML = `
                        <div class="card-main">
                            <div class="card-img">
                                ${item.isImg ? `<img src="${item.img}" style="width:100%; height:100%; border-radius:18px; object-fit:cover;">` : item.img}
                            </div>
                            <div class="card-info">
                                <b>${item.name}</b>
                                <span>–°–∫–ª–∞–¥: ${item.stock}</span>
                            </div>
                        </div>
                        <div class="card-price-block">
                            <div class="price-txt">${item.price.toLocaleString()} ‚Ç∏</div>
                            <div class="buy-label">–ö—É–ø–∏—Ç—å</div>
                        </div>
                    `;
                    el.onclick = () => logic.openBuy(item);
                    grid.appendChild(el);
                });
            },

            filter(cat, btn) {
                document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');
                tg.HapticFeedback.impactOccurred('medium');
                this.renderCatalog(cat);
            },

            switchView(view) {
                const views = ['view-store', 'view-profile'];
                const navs = ['nav-home', 'nav-profile'];

                views.forEach(v => document.getElementById(v).classList.add('hidden'));
                navs.forEach(n => document.getElementById(n).classList.remove('active'));

                document.getElementById('view-' + view).classList.remove('hidden');
                document.getElementById('nav-' + (view === 'store' ? 'home' : 'profile')).classList.add('active');
                
                tg.HapticFeedback.impactOccurred('light');
                window.scrollTo(0,0);
            },

            updateBalances() {
                const b = STATE.user.balance.toLocaleString() + " ‚Ç∏";
                document.getElementById('global-balance').innerText = b;
                document.getElementById('stat-balance').innerText = b;
                document.getElementById('stat-orders').innerText = STATE.user.orders;
            },

            closeSheets() {
                document.querySelectorAll('.sheet').forEach(s => s.classList.remove('open'));
            }
        };

        const logic = {
            openBuy(item) {
                STATE.currentSelection = item;
                document.getElementById('checkout-title').innerText = item.name;
                document.getElementById('kaspi-price-final').innerText = item.price.toLocaleString() + " ‚Ç∏";
                
                // Reset views
                document.getElementById('payment-methods-view').classList.remove('hidden');
                document.getElementById('kaspi-details').classList.add('hidden');

                document.getElementById('buy-sheet').classList.add('open');
                tg.HapticFeedback.impactOccurred('medium');
            },

            pay(method) {
                tg.HapticFeedback.impactOccurred('light');
                if(method === 'kaspi') {
                    document.getElementById('payment-methods-view').classList.add('hidden');
                    document.getElementById('kaspi-details').classList.remove('hidden');
                } else if(method === 'stars') {
                    const stars = Math.ceil(STATE.currentSelection.price / 8.5); // –ö—É—Ä—Å ~8.5 —Ç–µ–Ω–≥–µ –∑–∞ –∑–≤–µ–∑–¥—É
                    tg.showConfirm(`–û–ø–ª–∞—Ç–∏—Ç—å ${stars} ‚ú® –∑–∞ ${STATE.currentSelection.name}?`, (ok) => {
                        if(ok) this.finalize('Stars');
                    });
                } else {
                    tg.showAlert("–ú–µ—Ç–æ–¥ CryptoBot –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Kaspi.");
                }
            },

            copyCard() {
                const num = "4400430299887766";
                // –ù–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ WebApp –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è) –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π
                const tempInput = document.createElement("input");
                tempInput.value = num;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand("copy");
                document.body.removeChild(tempInput);
                
                tg.HapticFeedback.notificationOccurred('success');
                tg.showAlert("–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
            },

            finalize(method) {
                tg.HapticFeedback.notificationOccurred('success');
                tg.showPopup({
                    title: '–ó–∞–∫–∞–∑ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                    message: `–í–∞—à –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ ${method} –ø–æ–ª—É—á–µ–Ω. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —á–∞—Ç –±–æ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 5-15 –º–∏–Ω—É—Ç.`,
                    buttons: [{type: 'ok'}]
                });
                STATE.user.orders++;
                ui.updateBalances();
                ui.closeSheets();
            },

            startTopUp() {
                const amt = parseInt(document.getElementById('topup-amount').value);
                if(!amt || amt < 500) {
                    tg.showAlert("–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ‚Äî 500 ‚Ç∏");
                    return;
                }
                
                tg.showConfirm(`–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ${amt.toLocaleString()} ‚Ç∏?`, (ok) => {
                    if(ok) {
                        tg.showAlert("–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–∞–º –≤ –õ–°.");
                        ui.closeSheets();
                    }
                });
            }
        };

        function showTopUp() {
            document.getElementById('topup-sheet').classList.add('open');
            tg.HapticFeedback.impactOccurred('medium');
        }

        // –ó–∞–ø—É—Å–∫
        ui.init();
        tg.ready();
    </script>
</body>
</html>
