<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Genius Market v4.0 | Industrial Digital Distribution</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@500;800;900&family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #020617;
            --bg-card: #0f172a;
            --bg-accent: #1e293b;
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.15);
            --text-main: #f8fafc;
            --text-dim: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --gold: #fbbf24;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Manrope', sans-serif;
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .bg-glow {
            position: fixed; top: 0; left: 50%; transform: translateX(-50%);
            width: 100%; height: 500px;
            background: radial-gradient(circle at center, rgba(56, 189, 248, 0.08) 0%, transparent 70%);
            z-index: 0; pointer-events: none;
        }

        canvas#snow { position: fixed; inset: 0; z-index: 1; pointer-events: none; opacity: 0.3; }

        header {
            position: sticky; top: 0; z-index: 2000;
            background: rgba(2, 6, 23, 0.8); backdrop-filter: blur(20px);
            padding: 18px 24px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .logo { font-family: 'Unbounded'; font-weight: 800; font-size: 14px; letter-spacing: 1px; color: var(--accent); }
        .logo span { color: #fff; }

        .header-right { display: flex; align-items: center; gap: 10px; }

        .currency-switch {
            background: var(--bg-accent);
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 11px;
            font-weight: 800;
            color: #fff;
            cursor: pointer;
            transition: var(--transition);
        }
        .currency-switch:active { transform: scale(0.9); }

        .balance-chip {
            background: var(--bg-card); padding: 8px 14px; border-radius: 12px;
            border: 1px solid var(--accent-soft); display: flex; align-items: center; gap: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        .app-content { position: relative; z-index: 10; padding-bottom: 120px; }
        .screen { display: none; padding: 20px; animation: fadeIn 0.4s ease forwards; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .category-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; 
            margin-bottom: 25px; 
        }
        .cat-item {
            background: var(--bg-card); 
            border-radius: 16px; 
            padding: 15px 5px; 
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05); 
            cursor: pointer;
            transition: var(--transition);
        }
        .cat-item:active { transform: scale(0.9); background: var(--bg-accent); }
        .cat-item i { font-size: 22px; margin-bottom: 8px; display: block; }
        .cat-item .cat-label { 
            font-size: 9px; 
            font-weight: 700; 
            text-transform: uppercase; 
            color: var(--text-dim); 
            display: block;
        }

        .product-card {
            background: var(--bg-card); border-radius: 24px; padding: 20px; margin-bottom: 16px;
            border: 1px solid rgba(255,255,255,0.04); transition: var(--transition);
        }
        .product-card:active { border-color: var(--accent); }
        
        .p-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .p-title { font-size: 15px; font-weight: 800; color: #fff; max-width: 70%; line-height: 1.3; }
        .p-price { font-family: 'Unbounded'; color: var(--accent); font-size: 16px; font-weight: 800; }

        .p-badges { display: flex; gap: 6px; margin-bottom: 14px; flex-wrap: wrap; }
        .tag { font-size: 9px; font-weight: 800; padding: 5px 10px; border-radius: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .tag-gray { background: rgba(255,255,255,0.05); color: var(--text-dim); }
        .tag-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }

        .p-desc { font-size: 12px; color: var(--text-dim); margin-bottom: 20px; line-height: 1.5; }

        .action-btn {
            width: 100%; padding: 16px; border-radius: 18px; border: none;
            background: var(--accent); color: #000; font-family: 'Unbounded';
            font-size: 12px; font-weight: 800; cursor: pointer; transition: var(--transition);
            box-shadow: 0 8px 20px rgba(56, 189, 248, 0.2);
        }
        .action-btn:active { transform: translateY(2px); box-shadow: none; }

        .wallet-hero {
            background: linear-gradient(160deg, #0f172a 0%, #020617 100%);
            padding: 40px 24px; border-radius: 32px; border: 1px solid var(--accent-soft);
            text-align: center; margin-bottom: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .w-balance { font-family: 'Unbounded'; font-size: 42px; font-weight: 900; margin: 10px 0; }
        
        nav {
            position: fixed; bottom: 30px; left: 20px; right: 20px;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px);
            height: 72px; border-radius: 24px; display: flex; align-items: center;
            border: 1px solid rgba(255,255,255,0.08); z-index: 3000;
        }
        .nav-item { flex: 1; text-align: center; color: var(--text-dim); text-decoration: none; transition: 0.3s; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 20px; }
        .nav-item span { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            display: none; align-items: center; justify-content: center; z-index: 5000; padding: 20px;
            backdrop-filter: blur(10px);
        }
        .modal-card {
            background: var(--bg-card); width: 100%; max-width: 380px; border-radius: 32px;
            padding: 30px; border: 1px solid var(--accent-soft); text-align: center;
        }
        .modal-input {
            width: 100%; background: #000; border: 2px solid var(--accent-soft);
            padding: 20px; border-radius: 20px; color: #fff; font-size: 28px;
            font-family: 'Unbounded'; text-align: center; margin: 25px 0; outline: none;
        }
        .modal-input:focus { border-color: var(--accent); }

    </style>
</head>
<body>

<div class="bg-glow"></div>
<canvas id="snow"></canvas>

<header>
    <div class="logo">GENIUS <span>MARKET</span></div>
    <div class="header-right">
        <select class="currency-switch" id="currency-select" onchange="App.handleCurrencyChange(this.value)" style="background: var(--bg-accent); color: #fff; border: 1px solid rgba(255,255,255,0.1); padding: 8px 5px; border-radius: 12px; font-size: 11px; font-weight: 800; outline: none;">
            <option value="KZT">KZT ‚Ç∏</option>
            <option value="RUB">RUB ‚ÇΩ</option>
            <option value="USD">USD $</option>
            <option value="XTR">STARS ‚≠ê</option>
        </select>
        
        <div class="balance-chip">
            <span id="top-balance" style="font-weight: 800;">0</span>
            <span id="top-symbol" style="font-size: 10px; color: var(--accent); font-weight: 900;">‚Ç∏</span>
        </div>
    </div>
</header>

<div class="app-content">
    
    <section id="market-screen" class="screen active">
        <div class="category-grid">
            <div class="cat-item" onclick="App.openCat('Telegram')">
                <i class="fa-brands fa-telegram" style="color:var(--accent)"></i>
                <span class="cat-label">Telegram</span>
            </div>
            <div class="cat-item" onclick="App.openCat('Steam')">
                <i class="fa-brands fa-steam" style="color:#ffffff"></i>
                <span class="cat-label">Steam</span>
            </div>
            <div class="cat-item" onclick="App.openCat('Spotify')">
                <i class="fa-brands fa-spotify" style="color:#1DB954"></i>
                <span class="cat-label">Spotify</span>
            </div>
            <div class="cat-item" onclick="App.openCat('Discord')">
                <i class="fa-brands fa-discord" style="color:#5865F2"></i>
                <span class="cat-label">Discord</span>
            </div>
            <div class="cat-item" onclick="App.openCat('TikTok')">
                <i class="fa-brands fa-tiktok" style="color:#ffffff"></i>
                <span class="cat-label">TikTok</span>
            </div>
            <div class="cat-item" onclick="App.openCat('Instagram')">
                <i class="fa-brands fa-instagram" style="color:#E1306C"></i>
                <span class="cat-label">Instagram</span>
            </div>
            <div class="cat-item" onclick="App.openCat('WhatsApp')">
                <i class="fa-brands fa-whatsapp" style="color:#25D366"></i>
                <span class="cat-label">WhatsApp</span>
            </div>
            <div class="cat-item" onclick="App.openCat('VPN')">
                <i class="fa-solid fa-shield-halved" style="color:var(--accent)"></i>
                <span class="cat-label">VPN</span>
            </div>
        </div>

        <h3 style="font-family: 'Unbounded'; font-size: 12px; margin-bottom: 20px; color: var(--accent);">üî• –•–ò–¢–´ –ü–†–û–î–ê–ñ</h3>
        <div id="popular-render"></div>
    </section>

    <section id="category-screen" class="screen">
    <div onclick="App.handleBack()" style="color: var(--text-dim); font-weight: 800; font-size: 13px; margin-bottom: 25px; display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <i class="fa-solid fa-arrow-left-long"></i> 
        <span id="back-text">–ù–ê–ó–ê–î –í –ú–ï–ù–Æ</span>
    </div>
    <h2 id="cat-title" style="font-family: 'Unbounded'; font-size: 24px; margin-bottom: 25px;">–ö–ê–¢–ï–ì–û–†–ò–Ø</h2>
    <div id="cat-render"></div>
    </section>

    <section id="wallet-screen" class="screen">
        <div class="wallet-hero">
            <span style="font-size: 11px; font-weight: 800; color: var(--text-dim); letter-spacing: 2px;">–¢–ï–ö–£–©–ò–ô –ë–ê–õ–ê–ù–°</span>
            <div class="w-balance"><span id="w-val">0</span><span class="curr-sym" style="color: var(--accent); font-size: 20px; margin-left: 8px;">‚Ç∏</span></div>
            <p id="user-id" style="font-size: 10px; color: var(--text-dim); margin-top: 10px; font-weight: 700;">USER ID: ---</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 30px;">
            <button class="action-btn" onclick="App.toggleModal(true)" style="background: #fff; box-shadow: none;">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
            <button class="action-btn" style="background: var(--bg-accent); color: #fff; box-shadow: none; border: 1px solid rgba(255,255,255,0.05);">–í–´–í–û–î</button>
        </div>

        <div style="background: var(--bg-card); border-radius: 24px; padding: 25px; border: 1px dashed rgba(255,255,255,0.1); text-align: center;">
            <i class="fa-solid fa-clock-rotate-left" style="font-size: 24px; color: var(--bg-accent); margin-bottom: 12px;"></i>
            <p style="font-size: 12px; color: var(--text-dim);">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –ø—É—Å—Ç–∞</p>
        </div>
    </section>

    <section id="profile-screen" class="screen">
        <div style="text-align: center; margin: 20px 0 40px;">
            <div style="width: 110px; height: 110px; border-radius: 40px; background: var(--bg-card); border: 2px solid var(--accent); margin: 0 auto 20px; transform: rotate(-5deg); display: flex; align-items: center; justify-content: center; font-size: 40px; color: var(--accent); box-shadow: 0 15px 30px var(--accent-soft);">
                <i class="fa-solid fa-bolt" style="transform: rotate(5deg);"></i>
            </div>
            <h2 id="u-name" style="font-family: 'Unbounded'; font-size: 20px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
            <p style="color: var(--success); font-size: 11px; font-weight: 800; text-transform: uppercase; margin-top: 5px;">–°—Ç–∞—Ç—É—Å: Active Client</p>
        </div>

        <div style="background: var(--bg-card); border-radius: 28px; padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <span style="font-size: 13px; color: var(--text-dim);">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</span>
                <span style="font-weight: 800;">0 —à—Ç.</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0;">
                <span style="font-size: 13px; color: var(--text-dim);">–û–±—â–∞—è —Å—É–º–º–∞</span>
                <span id="profile-total" style="font-weight: 800; color: var(--accent);">0 ‚Ç∏</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 15px;">
                <span style="font-size: 13px; color: var(--text-dim);">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
                <span style="font-weight: 800; color: var(--gold);">@k3vinmaccalister</span>
            </div>
        </div>
    </section>

</div>

<div class="modal-overlay" id="modal-pay">
    <div class="modal-card">
        <h3 style="font-family: 'Unbounded'; font-size: 16px;">–í–´–ë–ï–†–ò–¢–ï –°–ü–û–°–û–ë</h3>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
            <button onclick="App.setPayMethod('crypto')" id="btn-crypto" style="background: var(--accent); color: #000; border: none; padding: 10px; border-radius: 12px; font-weight: 800; font-size: 10px;">CRYPTO</button>
            <button onclick="App.setPayMethod('stars')" id="btn-stars" style="background: var(--bg-accent); color: #fff; border: none; padding: 10px; border-radius: 12px; font-weight: 800; font-size: 10px;">STARS ‚≠ê</button>
        </div>

        <input type="number" id="pay-input" class="modal-input" placeholder="0" autofocus>
        
        <button class="action-btn" onclick="App.createInvoice()" style="padding: 20px; font-size: 14px;">–°–û–ó–î–ê–¢–¨ –°–ß–ï–¢</button>
        <button onclick="App.toggleModal(false)" style="background: transparent; border: none; color: var(--text-dim); margin-top: 20px; font-weight: 700; font-size: 12px;">–û–¢–ú–ï–ù–ê</button>
    </div>
</div>

<nav>
    <a href="javascript:void(0)" class="nav-item active" onclick="App.nav('market-screen', this)"><i class="fa-solid fa-house-chimney-window"></i><span>–ì–ª–∞–≤–Ω–∞—è</span></a>
    <a href="javascript:void(0)" class="nav-item" onclick="App.nav('wallet-screen', this)"><i class="fa-solid fa-wallet"></i><span>–ö–æ—à–µ–ª–µ–∫</span></a>
    <a href="javascript:void(0)" class="nav-item" onclick="App.nav('profile-screen', this)"><i class="fa-solid fa-user-ninja"></i><span>–ü—Ä–æ—Ñ–∏–ª—å</span></a>
</nav>

<script>
const DB = {
    'Telegram': {
        '–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ù–æ–º–µ—Ä–∞': [
            { name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (+7) | Tdata | –§–∏–∑–∏—á–µ—Å–∫–∞—è –°–∏–º-–ö–∞—Ä—Ç–∞', price: 700, tags: ['–° –æ—Ç–ª–µ–≥–æ–π', '–ê–≤—Ç–æ-—Ä–µ–≥'], desc: '–û—Ç–ª–µ–∂–∫–∞ –æ—Ç 6 –º–µ—Å—è—Ü–µ–≤. –ù–æ–º–µ—Ä–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ß–∏—Å—Ç—ã–µ –ø—Ä–æ–∫—Å–∏.' },
            { name: '–†–æ—Å—Å–∏—è (+7) | Session | 2FA', price: 750, tags: ['Fast', 'Soft'], desc: '–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞—Å—Å—ã–ª–æ–∫ –∏ –∏–Ω–≤–∞–π—Ç–∞. –ë–µ–∑ —Å–ø–∞–º–±–ª–æ–∫–∞.' },
            { name: 'USA (+1) | –†–µ–∞–ª—å–Ω—ã–µ –°–∏–º-–ö–∞—Ä—Ç—ã', price: 480, tags: ['Stable', 'USA'], desc: '–õ–∏—á–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –§–∏–∑–∏—á–µ—Å–∫–∏–π –°–∏–º-–ö–∞—Ä—Ç—ã –ê–º–µ—Ä–∏–∫–∏.' },
            { name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è (+44) | –†–µ–∞–ª—å–Ω—ã–µ –°–∏–º-–ö–∞—Ä—Ç—ã', price: 510, tags: ['Stable', 'UK'], desc: '–ù–µ –í–∞–ª–∏–¥ , –õ—é–±–æ–π —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞ , –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π.' },
            { name: '–ë–∞–Ω–≥–ª–∞–¥–µ—à (+880) | TG-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ', price: 470, tags: ['Telegram', 'Asia'], desc: '–≠–∫—Å–∫–ª—é–∑–∏–≤ –¥–ª—è Telegram ‚Ä¢ –ù–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Ä¢ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞.' },
            { name: '–ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω (+996) | Telegram –Ω–æ–º–µ—Ä–∞ ', price: 280, tags: ['Fast', 'KG'], desc: '–ù–∞–¥—ë–∂–Ω—ã–µ SIM, –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è Telegram, –õ—ë–≥–∫–∏–π –≤—Ö–æ–¥.' },
            { name: '–°–æ–º–∞–ª–∏ (+252)  | Telegram –Ω–æ–º–µ—Ä–∞ ', price: 280, tags: ['Fast', 'SO'], desc: '–ù–∞–¥—ë–∂–Ω—ã–µ SIM, –ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è Telegram, –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é.' },
            { name: '–ï–≥–∏–ø–µ—Ç (+20)  | Telegram –Ω–æ–º–µ—Ä–∞ ', price: 600, tags: ['Fast', 'EG'], desc: '–ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è Telegram, –õ—ë–≥–∫–∏–π –≤—Ö–æ–¥, –û—Ç–ª–µ–≥–∞ 6 –≥–æ–¥.' },
            { name: '–¢–∞–π–ª–∞–Ω–¥ (+66)  | Telegram –Ω–æ–º–µ—Ä–∞ ', price: 380, tags: ['Fast', 'TN'], desc: '–ù–µ –≤–∞–ª–∏–¥, –°–∞–º–æ-–†–µ–≥, –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥.' }
        ],
        'NFT': [
            { name: 'Cookie Heart', id: '#121967', price: 10000, img: 'ch.mp4', link: 'https://t.me/nft/CookieHeart-91192' },
            { name: 'Spiced Wine', id: '#64272', price: 1800, img: '2.mp4', link: 'https://t.me/nft/SpicedWine-13213' },
            { name: 'Joyful Bundle', id: '#55436', price: 9000, img: '3.mp4', link: 'https://t.me/nft/JoyfulBundle-32987' },
            { name: 'Instant Ramen', id: '#141425', price: 2500, img: '4.mp4', link: 'https://t.me/nft/InstantRamen-86247' },
            { name: 'Star Notepad', id: '#64959', price: 4000, img: 'https://i.getgems.io/W2lle264N8I46GjtkQ0YgSzV2HGmGjRhBaBkqXvLgBk/rs:fill:500:500:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUJBWFI2OGYxVWdSaFRvRlJfYlhZMXpQSnk1TzZzbTJTdDBDUlRvOTJCVHhHaUgvNjAzNDY0YWFmYTMzNDUyNw', link: '' },
            { name: 'Whip Cupcake', id: '#58951', price: 3000, img: 'https://i.getgems.io/jeU5MFNeoKnC3bLkLGpMEQ_IMPtkepBev7l1JBnlZ_I/rs:fill:500:500:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUFvX3NuQXBERHFGNkdLVjB4ZV9UNW9lMjhyODQyZ0p0Z21rZ1BNaFgwLWRSa2gvMzMwYjU0NzUzMDVjM2E0ZQ', link: '' },
            { name: 'Scared Cat', id: '#99821', price: 50000, img: 'https://i.getgems.io/MUkQqnzuGG-TaYbIMOsb0kZLLOp4x24RdO2LDlc-Bms/rs:fill:1000:0:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUFUdVVHZHZyakx2VFdFNXBwVkZPVkNxVTJkbENMVW5LVHN1MG4xSlltOWxhMTAvNmM1NzE1MTgyY2FjODY2YQ', link: '' },
            { name: 'Vintage Cigar', id: '#11223', price: 12000, img: 'https://i.getgems.io/f2rG2vUdBQK0FE64lapMMvESu5YKl0331Vq4qEXyWfA/rs:fill:500:500:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUFDY1FwUjJmbWRlRU5XZEUyWUdRV0hWeFNUeUE4WnE0X2s3cmtfSWF4Q1JYTmUvMDU4YTljZjJkN2RmNjU4OA', link: '' },
            { name: 'Lol Pop', id: '#77212', price: 2200, img: 'https://avatars.mds.yandex.net/i?id=d928e6c7be789cfc677f447a5647b65986210d71-4599934-images-thumbs&n=13', link: '' },
            { name: 'Jolly Chimp', id: '#33412', price: 5500, img: 'https://cache.tonapi.io/imgproxy/vveNd-TZkOuf23vE4xuR0nOCL4J2WnptIdIrETJfIGU/rs:fill:500:500:1/g:no/aHR0cHM6Ly9uZnQuZnJhZ21lbnQuY29tL2dpZnQvam9sbHljaGltcC0zMzI2MS53ZWJw.webp', link: '' },
            { name: 'Eternal Rose', id: '#99011', price: 15000, img: 'https://cache.tonapi.io/imgproxy/jTjDaPXL-OyUKK7a1u8D10MM0-YOeuudsgzPYJrR2yc/rs:fill:1500:1500:1/g:no/aHR0cHM6Ly9uZnQuZnJhZ21lbnQuY29tL2dpZnQvZXRlcm5hbHJvc2UtNTQ3OC53ZWJw.webp', link: '' },
            { name: 'Star Notepad', id: '#88219', price: 20000, img: 'https://i.getgems.io/3o-UtYfc7ZuAn_kTp8US15P_IIwJfhxNUlH5FBWAjGY/rs:fill:300:300:1/g:ce/czM6Ly9nZXRnZW1zLXMzL25mdC1jb250ZW50LWNhY2hlL2ltYWdlcy9FUUJBWFI2OGYxVWdSaFRvRlJfYlhZMXpQSnk1TzZzbTJTdDBDUlRvOTJCVHhHaUgvOTkwNjBkMzJjMGQwYWMzYg.jpg', link: '' }
],
        '–ó–≤–µ–∑–¥—ã': []
    },
    'WhatsApp': [
        { name: 'WA Business | –ò–Ω–¥–æ–Ω–µ–∑–∏—è (+62)', price: 2200, tags: ['Business', 'API'], desc: '–ê–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫. –í—ã—Å–æ–∫–∏–π –ª–∏–º–∏—Ç.' },
        { name: 'WA –õ–∏—á–Ω—ã–π | –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω (+7)', price: 1700, tags: ['Real', 'KZ'], desc: '–§–∏–∑. —Å–∏–º –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω. –†—É—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è.' },
        { name: 'WA –ê–≤—Ç–æ—Ä–µ–≥ | –ò–Ω–¥–∏—è (+91)', price: 800, tags: ['Cheap'], desc: '–ë—é–¥–∂–µ—Ç–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á.' }
    ],
    'TikTok': [
        { name: 'TikTok USA | –î–æ—Å—Ç—É–ø –∫ –°—Ç—Ä–∏–º–∞–º', price: 1200, tags: ['Live', 'USA'], desc: '–ê–∫–∫–∞—É–Ω—Ç—ã —Å –æ—Ç–∫—Ä—ã—Ç—ã–º Live-–¥–æ—Å—Ç—É–ø–æ–º –∏ Creator Program.' },
        { name: 'TikTok Ads | –ê–≥–µ–Ω—Ç—Å–∫–∏–π –∫–∞–±–∏–Ω', price: 4500, tags: ['Ads', 'Business'], desc: '–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä–µ–∫–ª–∞–º—ã –Ω–∞ –ª—é–±—ã–µ –ì–ï–û.' },
        { name: 'TikTok 1k+ –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤', price: 2800, tags: ['High Stats'], desc: '–ê–∫–∫–∞—É–Ω—Ç—ã —Å –∂–∏–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π.' },
        { name: 'TikTok –ü—Ä–æ–≥—Ä–µ—Ç—ã–π | RU IP', price: 500, tags: ['Warm-up'], desc: '–î–ª—è –∑–∞–ª–∏–≤–∞ –≤–∏–¥–µ–æ, —Ö–æ—Ä–æ—à–∏–µ –æ—Ö–≤–∞—Ç—ã.' }
    ],
    'Discord': [
        { name: 'Discord Nitro (Gift) | 1 Year', price: 18000, tags: ['Full Access'], desc: '–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –≥–∏—Ñ—Ç–æ–º –Ω–∞ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç.' },
        { name: 'Discord –¢–æ–∫–µ–Ω—ã | –ü–æ—á—Ç–∞+–¢–µ–ª', price: 150, tags: ['Verified'], desc: '–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Å–ø–∞–º–∞.' },
        { name: 'Discord –ê–∫–∫–∞—É–Ω—Ç | 2017 –ì–æ–¥', price: 4200, tags: ['Old School'], desc: '–†–∞—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å –±–æ–ª—å—à–æ–π –æ—Ç–ª–µ–∂–∫–æ–π.' }
    ],
    'VPN': [
        { name: 'Genius VPN | 2026 Premium', price: 5000, tags: ['Fast', 'No Logs'], desc: '–ù–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å. 100+ —Å—Ç—Ä–∞–Ω, –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.' }
    ],
    'Steam': [
        { name: 'Steam Turkey | –°–º–µ–Ω–∞ —Ä–µ–≥–∏–æ–Ω–∞', price: 1400, tags: ['Region'], desc: '–ü–µ—Ä–µ–≤–æ–¥ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ —Ä–µ–≥–∏–æ–Ω –¢—É—Ä—Ü–∏—è.' }
    ],
    'Spotify': [
        { name: 'Spotify Premium 12 –º–µ—Å', price: 8500, tags: ['Premium'], desc: '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–∞ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç.' }
    ],
    'Instagram': [
        { name: 'Insta 2015-2018', price: 900, tags: ['Old'], desc: '–ê–∫–∫–∞—É–Ω—Ç—ã —Å –±–æ–ª—å—à–æ–π –æ—Ç–ª–µ–∂–∫–æ–π.' }
    ]
};

const tg = window.Telegram.WebApp;

const App = {
    currentMethod: 'crypto', 
    currentCurrency: 'KZT',
    lastMainCat: null,
    rates: { 'KZT': 1, 'RUB': 0.19, 'USD': 0.0021, 'XTR': 0.1 }, 
    symbols: { 'KZT': '‚Ç∏', 'RUB': '‚ÇΩ', 'USD': '$', 'XTR': '‚≠ê' },

    init() {
        tg.expand();
        this.renderPopular();
        this.initSnow();
        this.syncUser();
        this.updateCurrencyUI();
        this.liveUser();
        setTimeout(() => tg.ready(), 500);
    },

    handleCurrencyChange(val) {
        this.currentCurrency = val;
        this.setPayMethod(val === 'XTR' ? 'stars' : 'crypto');
        this.updateCurrencyUI();
        this.renderPopular();
        const catTitleEl = document.getElementById('cat-title');
        const currentTitle = catTitleEl ? catTitleEl.innerText.trim() : "";
        if (currentTitle && currentTitle !== "–ö–ê–¢–ï–ì–û–†–ò–Ø") {
            if (this.lastMainCat && DB[this.lastMainCat] && DB[this.lastMainCat][currentTitle]) {
                this.renderItems(DB[this.lastMainCat][currentTitle], 'cat-render');
            } else if (DB[currentTitle]) {
                const data = DB[currentTitle];
                if (Array.isArray(data)) this.renderItems(data, 'cat-render');
            }
        }
        tg.HapticFeedback.impactOccurred('medium');
    },

    updateCurrencyUI() {
        const sym = this.symbols[this.currentCurrency];
        document.getElementById('top-symbol').innerText = sym;
        document.querySelectorAll('.curr-sym').forEach(el => el.innerText = sym);
        document.getElementById('profile-total').innerText = `0 ${sym}`;
        const wVal = document.getElementById('w-val');
        if (wVal && wVal.nextElementSibling) wVal.nextElementSibling.innerText = sym;
    },

    getConvertedPrice(priceKzt) {
        const rate = this.rates[this.currentCurrency];
        const sym = this.symbols[this.currentCurrency];
        const final = (priceKzt * rate);
        let formatted = this.currentCurrency === 'USD' ? final.toFixed(2) : Math.ceil(final).toLocaleString();
        return `${formatted} ${sym}`;
    },

    setPayMethod(method) {
        this.currentMethod = method;
        document.getElementById('btn-crypto').style.background = method === 'crypto' ? 'var(--accent)' : 'var(--bg-accent)';
        document.getElementById('btn-crypto').style.color = method === 'crypto' ? '#000' : '#fff';
        document.getElementById('btn-stars').style.background = method === 'stars' ? 'var(--gold)' : 'var(--bg-accent)';
        document.getElementById('btn-stars').style.color = method === 'stars' ? '#000' : '#fff';
    },

    createInvoice() {
        const val = document.getElementById('pay-input').value;
        if(!val) return;
        tg.showConfirm(`–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç –Ω–∞ ${val} ${this.symbols[this.currentCurrency]} —á–µ—Ä–µ–∑ ${this.currentMethod.toUpperCase()}?`, (ok) => {
            if(ok) {
                tg.sendData(JSON.stringify({ type: "deposit", method: this.currentMethod, amount: Number(val), currency: this.currentCurrency }));
                tg.close();
            }
        });
    },

    openCat(name) {
        const data = DB[name];
        const container = document.getElementById('cat-render');
        document.getElementById('cat-title').innerText = name;
        document.getElementById('back-text').innerText = "–ù–ê–ó–ê–î –í –ú–ï–ù–Æ";
        this.lastMainCat = null; 
        this.nav('category-screen');

        if (data && !Array.isArray(data)) {
            container.style.display = 'block';
            container.innerHTML = Object.keys(data).map(sub => `
                <div class="product-card" onclick="App.renderSubCat('${name}', '${sub}')" style="display: flex; justify-content: space-between; align-items: center; padding: 22px; cursor: pointer; border: 1px solid rgba(56, 189, 248, 0.1);">
                    <span style="font-family: 'Unbounded'; font-size: 13px; color: #fff; font-weight: 800;">${sub.toUpperCase()}</span>
                    <i class="fa-solid fa-chevron-right" style="color: var(--accent);"></i>
                </div>
            `).join('');
        } else {
            this.renderItems(data || [], 'cat-render');
        }
    },

    renderSubCat(mainCat, subCat) {
        this.lastMainCat = mainCat; 
        document.getElementById('back-text').innerText = "–ù–ê–ó–ê–î";
        document.getElementById('cat-title').innerText = subCat;
        this.renderItems(DB[mainCat][subCat], 'cat-render');
        tg.HapticFeedback.impactOccurred('light');
    },

    handleBack() {
        if (this.lastMainCat) {
            this.openCat(this.lastMainCat);
        } else {
            this.nav('market-screen');
        }
    },

    renderItems(items, targetId) {
    const container = document.getElementById(targetId);
    if(!items || !items.length) {
        container.innerHTML = '<p style="color:var(--text-dim); text-align:center; padding: 40px 0;">–¢–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è...</p>';
        return;
    }

    if (items[0] && items[0].img) {
        container.style.display = 'grid';
        container.style.gridTemplateColumns = 'repeat(3, 1fr)'; 
        container.style.gap = '8px'; 
        container.innerHTML = items.map(i => {
            const isVideo = i.img.toLowerCase().endsWith('.mp4');
            const mediaTag = isVideo 
                ? `<video src="${i.img}" autoplay loop muted playsinline style="width:100%; height:100%; object-fit:cover;"></video>`
                : `<img src="${i.img}" style="width:100%; height:100%; object-fit:cover;">`;

            return `
                <div class="product-card" style="padding:8px; margin-bottom:0; display:flex; flex-direction:column; border-radius:14px; background: rgba(15, 23, 42, 0.5);">
                    
                    <a href="${i.link || '#'}" target="_blank" style="width:100%; aspect-ratio:1/1; border-radius:10px; background:var(--bg-accent); margin-bottom:6px; overflow:hidden; display:flex; text-decoration:none;">
                        ${mediaTag}
                    </a>

                    <div style="font-size:10px; font-weight:800; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${i.name}</div>
                    <div style="font-size:8px; color:var(--text-dim); margin-bottom:6px;">${i.id}</div>
                    <button class="action-btn" onclick="App.buy('${i.name}', ${i.price})" style="padding:6px 2px; font-size:9px; height:auto; background:var(--accent); color:#000; box-shadow:none; border-radius:8px;">
                        ${this.getConvertedPrice(i.price).replace(' ', '')}
                    </button>
                </div>
            `;
        }).join('');
    } else {
        container.style.display = 'block';
        container.innerHTML = items.map(i => `
            <div class="product-card">
                <div class="p-header">
                    <span class="p-title">${i.name}</span>
                    <span class="p-price">${this.getConvertedPrice(i.price)}</span>
                </div>
                <div class="p-badges">
                    ${i.tags ? i.tags.map(t => `<span class="tag tag-gray">${t}</span>`).join('') : ''}
                    <span class="tag tag-success">–ë–µ–∑ –°–ø–∞–º–±–ª–æ–∫–∞</span>
                </div>
                <p class="p-desc">${i.desc || ''}</p>
                <button class="action-btn" onclick="App.buy('${i.name}', ${i.price})">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
            </div>
        `).join('');
    }
},

    renderPopular() {
        const hits = [...DB['Telegram']['–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ù–æ–º–µ—Ä–∞'].slice(0,2), ...DB['TikTok'].slice(0,2)];
        this.renderItems(hits, 'popular-render');
    },

    buy(name, priceKzt) {
        const displayPrice = this.getConvertedPrice(priceKzt);
        tg.showConfirm(`–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É ${name} –∑–∞ ${displayPrice}?`, (ok) => {
            if(ok) {
                tg.showPopup({
                    title: "–ë–∞–ª–∞–Ω—Å –ø—É—Å—Ç",
                    message: "–î–ª—è –ø–æ–∫—É–ø–∫–∏ –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.",
                    buttons: [{id: "pay", type: "default", text: "–ü–æ–ø–æ–ª–Ω–∏—Ç—å"}, {type: "cancel", text: "–û—Ç–º–µ–Ω–∞"}]
                }, (btn) => { if(btn === "pay") this.nav('wallet-screen', document.querySelectorAll('.nav-item')[1]); });
            }
        });
    },

    syncUser() {
        if(tg.initDataUnsafe?.user) {
            const u = tg.initDataUnsafe.user;
            document.getElementById('u-name').innerText = u.username ? `@${u.username}` : u.first_name;
            document.getElementById('user-id').innerText = `USER ID: ${u.id}`;
        }
    },

    liveUser() {
        setInterval(() => this.syncUser(), 5000);
    },

    nav(id, el) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(el) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
        tg.HapticFeedback.impactOccurred('medium');
        window.scrollTo(0,0);
    },

    toggleModal(show) {
        document.getElementById('modal-pay').style.display = show ? 'flex' : 'none';
        if(show) {
            document.getElementById('pay-input').value = '';
            tg.HapticFeedback.impactOccurred('light');
        }
    },

    initSnow() {
        const canvas = document.getElementById('snow');
        const ctx = canvas.getContext('2d');
        let flakes = [];
        const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        window.addEventListener('resize', resize); resize();
        for(let i=0; i<50; i++) flakes.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: Math.random()*2+0.5, f: Math.random()*0.5+0.2 });
        const loop = () => {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white"; ctx.beginPath();
            flakes.forEach(fl => {
                ctx.moveTo(fl.x, fl.y); ctx.arc(fl.x, fl.y, fl.r, 0, Math.PI*2);
                fl.y += fl.f; if(fl.y > canvas.height) fl.y = -5;
            });
            ctx.fill(); requestAnimationFrame(loop);
        };
        loop();
    }
};

App.init();
</script>

</body>
</html>
