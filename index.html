<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Genius Market | Новый Год</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* =========================================================
           GLOBAL STYLES & VARIABLES (MAIN THEME)
           ========================================================= */
        :root {
            --bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --accent-blue: #007AFF;
            --genius-yellow: #FFD700;
            --text-main: #1E293B;
            --text-dim: #64748B;
            --border-color: #E2E8F0;
            --shadow: 0 10px 30px rgba(0, 122, 255, 0.05);
            --christmas-red: #E63946;
            --christmas-green: #38B000;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Manrope', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg);
            color: var(--text-main);
            overflow-x: hidden;
            padding-bottom: 90px; /* Space for bottom navigation */
        }

        /* =========================================================
           CHRISTMAS SNOWFALL ANIMATION (NEW FEATURE)
           ========================================================= */
        .snow-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; overflow: hidden;
            background: linear-gradient(to bottom, #d6eaff, #f8faff); /* Light gradient for winter sky */
        }

        .snow {
            position: absolute; background: white; border-radius: 50%;
            opacity: 0.8; animation: snowfall linear infinite;
        }

        /* Snowflake properties (dynamic via JS, but base here) */
        @keyframes snowfall {
            0% { transform: translateY(-100%) scale(1); opacity: 0.8; }
            100% { transform: translateY(100vh) scale(0.5); opacity: 0.4; }
        }

        /* =========================================================
           HEADER & BALANCE (TOP BAR)
           ========================================================= */
        .header {
            padding: 20px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
        }
        .logo { font-family: 'Unbounded'; font-size: 16px; color: var(--accent-blue); letter-spacing: -0.5px; }
        .balance {
            background: var(--genius-yellow);
            padding: 8px 14px; border-radius: 12px;
            font-weight: 800; font-size: 13px; color: #000;
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.2);
            cursor: pointer; /* Clickable balance */
        }

        /* =========================================================
           MAIN CONTENT SECTIONS (PAGES)
           ========================================================= */
        .container { padding: 15px; }
        .page { display: none; animation: fadeIn 0.4s ease-out; }
        .page.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title { font-family: 'Unbounded'; font-size: 14px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }

        /* =========================================================
           MARKET GRID (LOLZ STYLE WITH SOFT UI)
           ========================================================= */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .service-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 15px 10px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; transition: 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: var(--shadow);
            cursor: pointer;
        }

        .service-card:active { transform: scale(0.92); border-color: var(--accent-blue); }
        .service-card i { font-size: 24px; margin-bottom: 10px; color: var(--accent-blue); }
        .service-card span { font-size: 12px; font-weight: 700; color: var(--text-main); }
        
        /* Brand Specific Icon Colors */
        .fa-whatsapp { color: #25D366 !important; }
        .fa-tiktok { color: #000000 !important; } /* TikTok's main logo is black */
        .fa-instagram { color: #E1306C !important; }
        .fa-telegram { color: #26A5E4 !important; }
        .fa-gem { color: var(--genius-yellow) !important; }
        .fa-shield-halved { color: var(--accent-blue) !important; }
        .fa-receipt { color: var(--christmas-red) !important; }
        .fa-coins { color: var(--christmas-green) !important; }

        /* =========================================================
           RECENT ITEMS LIST (MARKET PAGE)
           ========================================================= */
        .recent-list { display: flex; flex-direction: column; gap: 12px; }
        .item-row {
            background: var(--card-bg);
            padding: 15px; border-radius: 18px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            cursor: pointer;
        }
        .item-row:active { transform: scale(0.98); }
        .item-info { display: flex; align-items: center; gap: 12px; }
        .item-icon { width: 40px; height: 40px; border-radius: 12px; background: var(--bg); display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .item-text h4 { font-size: 14px; font-weight: 800; color: var(--text-main); }
        .item-text p { font-size: 11px; color: var(--text-dim); }
        .item-price { font-weight: 800; color: var(--accent-blue); font-size: 14px; }

        /* =========================================================
           PROFILE PAGE STYLES
           ========================================================= */
        .profile-card {
            background: var(--card-bg); border-radius: 20px; padding: 25px;
            border: 1px solid var(--border-color); box-shadow: var(--shadow);
            margin-bottom: 20px; text-align: center;
        }
        .avatar { width: 80px; height: 80px; background: var(--border-color); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 36px;
            color: var(--accent-blue); margin: 0 auto 15px; }
        .profile-name { font-family: 'Unbounded'; font-size: 18px; margin-bottom: 5px; }
        .profile-id { font-size: 12px; color: var(--text-dim); margin-bottom: 20px; }

        .profile-action-btn {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            background: var(--accent-blue); color: white; font-weight: 800;
            cursor: pointer; margin-top: 10px; transition: 0.2s;
        }
        .profile-action-btn:active { transform: scale(0.98); opacity: 0.9; }

        /* =========================================================
           BOTTOM NAVIGATION (FIXED TAB BAR)
           ========================================================= */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            height: 70px; border-radius: 24px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
            padding-bottom: env(safe-area-inset-bottom); /* For iPhone notches */
        }
        .nav-link { 
            color: var(--text-dim); text-align: center; flex: 1; font-size: 10px; 
            font-weight: 800; text-transform: uppercase; text-decoration: none;
            transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; /* Make entire area clickable */
        }
        .nav-link.active { color: var(--accent-blue); transform: translateY(-3px); }
        .nav-link i { display: block; font-size: 20px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div class="snow-container" id="snowfall-layer"></div>

    <header class="header">
        <div class="logo">GENIUS MARKET</div>
        <div class="balance" onclick="openPaymentPage()">5,450 ₸</div>
    </header>

    <main class="container">
        <section id="market-page" class="page active">
            <h2 class="section-title">Категории сервисов</h2>
            <div class="market-grid">
                <div class="service-card" onclick="openServiceDetail('Telegram')">
                    <i class="fa-brands fa-telegram"></i>
                    <span>Telegram</span>
                </div>
                <div class="service-card" onclick="openServiceDetail('WhatsApp')">
                    <i class="fa-brands fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </div>
                <div class="service-card" onclick="openServiceDetail('TikTok')">
                    <i class="fa-brands fa-tiktok"></i>
                    <span>TikTok</span>
                </div>
                <div class="service-card" onclick="openServiceDetail('Instagram')">
                    <i class="fa-brands fa-instagram"></i>
                    <span>Instagram</span>
                </div>
                <div class="service-card" onclick="openServiceDetail('NFT')">
                    <i class="fa-solid fa-gem"></i>
                    <span>NFT</span>
                </div>
                <div class="service-card" onclick="openServiceDetail('VPN')">
                    <i class="fa-solid fa-shield-halved"></i>
                    <span>VPN</span>
                </div>
            </div>

            <h2 class="section-title">Свежие поступления</h2>
            <div class="recent-list">
                <div class="item-row" onclick="openProduct('Telegram Premium')">
                    <div class="item-info">
                        <div class="item-icon"><i class="fa-brands fa-telegram" style="color:#26A5E4"></i></div>
                        <div class="item-text"><h4>Telegram Premium</h4><p>Активация на 1 год</p></div>
                    </div>
                    <div class="item-price">12,500 ₸</div>
                </div>
                <div class="item-row" onclick="openProduct('Genius VPN')">
                    <div class="item-info">
                        <div class="item-icon"><i class="fa-solid fa-shield-halved" style="color:#007AFF"></i></div>
                        <div class="item-text"><h4>Genius VPN</h4><p>Турция | 1 месяц</p></div>
                    </div>
                    <div class="item-price">1,200 ₸</div>
                </div>
            </div>
        </section>

        <section id="purchases-page" class="page">
            <h2 class="section-title">Мои покупки</h2>
            <div class="item-row">
                <div class="item-info">
                    <div class="item-icon"><i class="fa-brands fa-whatsapp" style="color:#25D366"></i></div>
                    <div class="item-text"><h4>WA Номер США</h4><p>Куплен: 12.12.2023</p></div>
                </div>
                <div class="item-price">800 ₸</div>
            </div>
            <div class="item-row">
                <div class="item-info">
                    <div class="item-icon"><i class="fa-solid fa-gem" style="color: var(--genius-yellow);"></i></div>
                    <div class="item-text"><h4>NFT #001</h4><p>Дата: 01.01.2024</p></div>
                </div>
                <div class="item-price">25,000 ₸</div>
            </div>
            <p style="text-align: center; color: var(--text-dim); margin-top: 40px; font-size: 14px;">Пока нет активных покупок.</p>
        </section>

        <section id="wallet-page" class="page">
            <h2 class="section-title">Мой кошелек</h2>
            <div class="profile-card">
                <p style="font-size: 14px; color: var(--text-dim); margin-bottom: 10px;">Текущий баланс</p>
                <h3 style="font-family: 'Unbounded'; font-size: 32px; color: var(--genius-yellow); margin-bottom: 20px;">5,450 ₸</h3>
                <button class="profile-action-btn" onclick="openPaymentPage()">ПОПОЛНИТЬ БАЛАНС</button>
                <button class="profile-action-btn" style="background: var(--border-color); color: var(--text-main); margin-top: 15px;">ИСТОРИЯ ОПЕРАЦИЙ</button>
            </div>
        </section>

        <section id="profile-page" class="page">
            <h2 class="section-title">Личный кабинет</h2>
            <div class="profile-card">
                <div class="avatar"><i class="fa-solid fa-user-gear"></i></div>
                <h3 class="profile-name" id="profile-username">Загрузка...</h3>
                <p class="profile-id" id="profile-userid">ID: Загрузка...</p>
                
                <button class="profile-action-btn" style="background: var(--christmas-red);" onclick="tg.showAlert('Вы вышли из аккаунта!')">ВЫЙТИ</button>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <a href="#market" class="nav-link active" onclick="switchPage('market-page', this)">
            <i class="fa-solid fa-house"></i><span>Маркет</span>
        </a>
        <a href="#purchases" class="nav-link" onclick="switchPage('purchases-page', this)">
            <i class="fa-solid fa-receipt"></i><span>Покупки</span>
        </a>
        <a href="#wallet" class="nav-link" onclick="switchPage('wallet-page', this)">
            <i class="fa-solid fa-coins"></i><span>Кошелек</span>
        </a>
        <a href="#profile" class="nav-link" onclick="switchPage('profile-page', this)">
            <i class="fa-solid fa-user"></i><span>Профиль</span>
        </a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = '#FFFFFF';
        tg.backgroundColor = '#F8FAFC'; // Match body background for seamless look

        // Function to switch between pages
        function switchPage(pageId, element) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            element.classList.add('active');
            
            tg.HapticFeedback.impactOccurred('light'); // Soft vibration feedback
            window.scrollTo(0, 0); // Scroll to top on page switch
        }

        // Placeholder for opening service details (Telegram, WhatsApp, etc.)
        function openServiceDetail(serviceName) {
            tg.HapticFeedback.impactOccurred('medium');
            tg.showAlert(`Открываем страницу для ${serviceName} сервиса.`);
            // In a real app, this would open a new page/modal with products for this service
        }

        // Placeholder for opening individual product page
        function openProduct(productName) {
            tg.HapticFeedback.impactOccurred('medium');
            tg.showAlert(`Выбрали товар: ${productName}.`);
            // This would lead to a product description and buy button
        }

        // Function to open the separate payment page (from previous conversations)
        function openPaymentPage() {
            tg.HapticFeedback.impactOccurred('heavy');
            // Here you would redirect to your payment HTML page, e.g.:
            // tg.openLink('YOUR_PAYMENT_SITE_URL.html');
            tg.showAlert('Переход на страницу пополнения баланса! (Пока заглушка)');
        }

        // Populate profile data from Telegram Mini App initData
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('profile-username').innerText = tg.initDataUnsafe.user.first_name || 'Пользователь';
            document.getElementById('profile-userid').innerText = `ID: ${tg.initDataUnsafe.user.id}`;
        } else {
             document.getElementById('profile-username').innerText = 'Тестовый пользователь';
             document.getElementById('profile-userid').innerText = `ID: 123456789`;
        }

        // =========================================================
        // SNOWFALL JAVASCRIPT LOGIC (DYNAMIC SNOW GENERATION)
        // =========================================================
        const snowContainer = document.getElementById('snowfall-layer');

        function createSnowflake() {
            const snow = document.createElement('div');
            snow.classList.add('snow');
            snowContainer.appendChild(snow);

            const size = Math.random() * 5 + 2; // Size from 2px to 7px
            const duration = Math.random() * 15 + 5; // Fall duration from 5s to 20s
            const delay = Math.random() * 10; // Start delay
            const left = Math.random() * 100; // Starting X position

            snow.style.width = `${size}px`;
            snow.style.height = `${size}px`;
            snow.style.left = `${left}vw`;
            snow.style.animationDuration = `${duration}s`;
            snow.style.animationDelay = `${delay}s`;
            snow.style.animationName = `snowfall`; // Use CSS animation keyframe
            snow.style.animationIterationCount = 'infinite';
            snow.style.animationTimingFunction = 'linear';
            
            // Remove snowflake after it falls to prevent DOM overload
            snow.addEventListener('animationiteration', () => {
                snow.style.left = `${Math.random() * 100}vw`;
                snow.style.animationDuration = `${Math.random() * 15 + 5}s`;
                snow.style.animationDelay = `0s`; // Reset delay
            });
        }

        // Generate a good amount of snowflakes
        for (let i = 0; i < 50; i++) { // 50 snowflakes
            createSnowflake();
        }

    </script>
</body>
</html>
